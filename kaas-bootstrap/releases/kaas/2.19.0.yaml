apiVersion: kaas.mirantis.com/v1alpha1
kind: KaaSRelease
metadata:
  name: kaas-2-19-0
spec:
  version: 2.19.0
  clusterRelease: mke-11-3-0-3-5-3
  supportedClusterReleases:
  - version: 7.8.0
    name: mke-7-8-0-3-4-8
    availableUpgrades:
      - version: 7.9.0
  - version: 7.9.0
    name: mke-7-9-0-3-4-9
    availableUpgrades:
      - version: 11.3.0
  - version: 8.6.0
    name: mosk-8-6-0-22-2
    tag: openstack
    availableUpgrades:
      - version: 8.8.0
  - version: 8.8.0
    name: mosk-8-8-0-22-3
    tag: openstack
  - version: 11.2.0
    name: mke-11-2-0-3-5-3
    availableUpgrades:
      - version: 11.3.0
  - version: 11.3.0
    name: mke-11-3-0-3-5-3
  - version: 10.3.4
    name: mke-10-3-4
    availableUpgrades:
    - version: 10.3.5
    providers:
      supported:
        - byo
  - version: 10.3.5
    name: mke-10-3-5
    providers:
      supported:
        - byo
    availableUpgrades:
      - version: 10.6.1
  - version: 10.4.2
    name: mke-10-4-2
    providers:
      supported:
        - byo
    availableUpgrades:
      - version: 10.4.3
  - version: 10.4.3
    name: mke-10-4-3
    providers:
      supported:
        - byo
    availableUpgrades:
      - version: 10.6.1
  - version: 10.5.1
    name: mke-10-5-1
    providers:
      supported:
        - byo
    availableUpgrades:
      - version: 10.5.2
  - version: 10.5.2
    name: mke-10-5-2
    providers:
      supported:
        - byo
    availableUpgrades:
      - version: 10.6.1
  - version: 10.6.1
    name: mke-10-6-1
    providers:
      supported:
        - byo
    availableUpgrades:
      - version: 13.3.2
  - version: 13.0.2
    name: mke-13-0-2
    providers:
      supported:
        - byo
    availableUpgrades:
      - version: 13.0.3
  - version: 13.0.3
    name: mke-13-0-3
    providers:
      supported:
        - byo
    availableUpgrades:
      - version: 13.3.2
  - version: 13.1.2
    name: mke-13-1-2
    providers:
      supported:
        - byo
    availableUpgrades:
      - version: 13.1.3
  - version: 13.1.3
    name: mke-13-1-3
    providers:
      supported:
        - byo
    availableUpgrades:
      - version: 13.3.2
  - version: 13.2.1
    name: mke-13-2-1
    providers:
      supported:
        - byo
    availableUpgrades:
      - version: 13.2.2
  - version: 13.2.2
    name: mke-13-2-2
    providers:
      supported:
        - byo
    availableUpgrades:
      - version: 13.3.2
  - version: 13.3.1
    name: mke-13-3-1
    providers:
      supported:
        - byo
    availableUpgrades:
      - version: 13.3.2
  - version: 13.3.2
    name: mke-13-3-2
    providers:
      supported:
        - byo
  bootstrap:
    version: 1.32.6
    helmReleases:
      - &admission-controller
        name: admission-controller
        chartURL: core/helm/admission-controller-1.32.10.tgz
        helmV3: true
        version: 1.32.10
        namespace: kaas
        values:
          image:
            tag: 1.32.10
      - name: bootstrap-provider
        chartURL: core/helm/bootstrap-provider-1.32.4.tgz
        helmV3: true
        version: 1.32.4
        namespace: kaas
        values:
          image:
            tag: 1.32.4
      - &baremetal-public-api
        name: baremetal-public-api
        helmV3: true
        version: 6.2.8
        chartURL: bm/helm/baremetal-public-api-6.2.8.tgz
        namespace: kaas
        values: {}
      - &kaas-public-api
        name: kaas-public-api
        helmV3: true
        chartURL: core/helm/kaas-public-api-1.32.4.tgz
        version: 1.32.4
        namespace: kaas
        values: {}
      - &kaas-ui
        name: kaas-ui
        helmV3: true
        chartURL: core/helm/kaas-ui-1.32.10.tgz
        version: 1.32.10
        namespace: kaas
        values: &kaas-ui-values
          image:
            tag: 1.32.10
      - name: managed-lcm-api
        chartURL: core/helm/managed-lcm-api-1.32.4.tgz
        version: 1.32.4
        namespace: default
        values: {}
      - name: portforward-controller
        helmV3: true
        chartURL: core/helm/portforward-controller-1.32.4.tgz
        version: 1.32.4
        namespace: kaas
        values:
          image:
            tag: 1.32.4
      - &rbac-controller
        name: rbac-controller
        helmV3: true
        chartURL: core/helm/rbac-controller-1.32.4.tgz
        version: 1.32.4
        namespace: kaas
        values:
          image:
            tag: 1.32.4
      - &release-controller
        name: release-controller
        helmV3: true
        chartURL: core/helm/release-controller-1.32.4.tgz
        version: 1.32.4
        namespace: kaas
        values:
          image:
            tag: 1.32.4
  helmRepositories:
  - name: kaas-iam
    url: iam/helm
  management:
    helmReleases:
    - name: iam
      helmV3: true
      requires:
      - local-volume-provisioner
      localVolumes:
      - name: kaas-iam-data
        bindMounts:
        - volPerNode: 1
      version: 2.4.29
      chart: kaas-iam/iam
      namespace: kaas
      values:
        api:
          # Set during bootstrap
          # keycloak:
          #   url:
          #   ca:
          tls:
            enabled: true
          service:
            type: LoadBalancer
            # Set during bootstrap
            # loadBalancerIP:
        keycloak:
          deployTimeout: 1200
          initDb: false
          service:
            type: LoadBalancer
            # Set during bootstrap
            # loadBalancerIP:
          mariadb:
            volume:
              class_name: iam-kaas-iam-data
    - <<: *kaas-ui
      values:
        <<: *kaas-ui-values
        rbac:
          create: true

    - name: iam-controller
      helmV3: true
      chartURL: core/helm/iam-controller-1.32.4.tgz
      version: 1.32.4
      namespace: kaas
      values:
        image:
          tag: 1.32.4

    - name: iam-public-api
      helmV3: true
      chartURL: core/helm/iam-public-api-1.32.4.tgz
      version: 1.32.4
      namespace: kaas
      values: {}

    - name: cert-manager
      helmV3: true
      chartURL: core/helm/cert-manager-1.32.4.tgz
      version: 1.32.4
      namespace: kaas
      requires:
      - kaas-public-api
      values: {}

    - name: user-controller
      helmV3: true
      chartURL: core/helm/user-controller-1.32.4.tgz
      version: 1.32.4
      namespace: kaas
      values:
        image:
          tag: 1.32.4

    - name: scope-controller
      helmV3: true
      chartURL: core/helm/scope-controller-1.32.4.tgz
      version: 1.32.4
      namespace: kaas
      values:
        image:
          tag: 1.32.4

    - *admission-controller

    - *release-controller

    - name: kaas-exporter
      helmV3: true
      chartURL: core/helm/kaas-exporter-1.32.4.tgz
      version: 1.32.4
      namespace: kaas
      values:
        image:
          tag: 1.32.4

    - *kaas-public-api

    - *baremetal-public-api

    - name: proxy-controller
      helmV3: true
      chartURL: core/helm/proxy-controller-1.32.4.tgz
      version: 1.32.4
      namespace: kaas
      values:
        image:
          tag: 1.32.4

    - name: rhellicense-controller
      helmV3: true
      chartURL: core/helm/rhellicense-controller-1.32.4.tgz
      version: 1.32.4
      namespace: kaas
      values:
        image:
          tag: 1.32.4

    - name: license-controller
      helmV3: true
      chartURL: core/helm/license-controller-1.32.4.tgz
      version: 1.32.4
      namespace: kaas
      values:
        image:
          tag: 1.32.4

    - name: event-controller
      helmV3: true
      chartURL: core/helm/event-controller-1.32.4.tgz
      version: 1.32.4
      namespace: kaas
      values:
        image:
          tag: 1.32.4

    - name: machinepool-controller
      helmV3: true
      chartURL: core/helm/machinepool-controller-1.32.4.tgz
      version: 1.32.4
      namespace: kaas
      values:
        image:
          tag: 1.32.4

  regional:
  - provider: openstack
    helmReleases:
    - name: openstack-provider
      helmV3: true
      chartURL: core/helm/openstack-provider-1.32.4.tgz
      version: 1.32.4
      namespace: kaas
      values:
        images:
          openstackMachineController:
            tag: 1.32.4
    - name: os-credentials-controller
      helmV3: true
      chartURL: core/helm/os-credentials-controller-1.32.4.tgz
      version: 1.32.4
      namespace: kaas
      values:
        image:
          tag: 1.32.4
  - provider: baremetal
    helmReleases:
      - &baremetal-api
        name: baremetal-api
        helmV3: true
        version: 6.2.8
        chartURL: bm/helm/baremetal-api-6.2.8.tgz
        namespace: kaas
        values: {}
      - &baremetal-operator
        name: baremetal-operator
        helmV3: true
        version: 6.2.8
        chartURL: bm/helm/baremetal-operator-6.2.8.tgz
        namespace: kaas
        values: {}
      - &kaas-ipam
        name: kaas-ipam
        helmV3: true
        version: 6.2.8
        chartURL: bm/helm/kaas-ipam-6.2.8.tgz
        namespace: kaas
        values: {}
      - name: baremetal-provider
        helmV3: true
        chartURL: core/helm/baremetal-provider-1.32.4.tgz
        version: 1.32.4
        namespace: kaas
        values:
          cluster_api_provider_baremetal:
            image:
              tag: 1.32.4
      - &ceph-kkc-controller
        name: ceph-kcc-controller
        helmV3: true
        chartURL: core/helm/ceph-kcc-controller-1.32.8.tgz
        version: 1.32.8
        namespace: kaas
        values:
          image:
            tag: 1.32.8
  - provider: aws
    helmReleases:
      - name: aws-provider
        helmV3: true
        chartURL: core/helm/aws-provider-1.32.4.tgz
        version: 1.32.4
        namespace: kaas
        values:
          awsController:
            image:
              tag: 1.32.4
      - name: aws-credentials-controller
        helmV3: true
        chartURL: core/helm/aws-credentials-controller-1.32.4.tgz
        version: 1.32.4
        namespace: kaas
        values:
          image:
            tag: 1.32.4
  - provider: byo
    helmReleases:
      - name: byo-provider
        helmV3: true
        chartURL: core/helm/byo-provider-1.32.4.tgz
        version: 1.32.4
        namespace: kaas
        values:
          byoController:
            image:
              tag: 1.32.4
      - name: byo-credentials-controller
        helmV3: true
        chartURL: core/helm/byo-credentials-controller-1.32.4.tgz
        version: 1.32.4
        namespace: kaas
        values:
          image:
            tag: 1.32.4
  - provider: vsphere
    helmReleases:
      - name: vsphere-provider
        helmV3: true
        chartURL: core/helm/vsphere-provider-1.32.4.tgz
        version: 1.32.4
        namespace: kaas
        values:
          vsphere_provider:
            image:
              tag: 1.32.4
      - name: vsphere-credentials-controller
        helmV3: true
        chartURL: core/helm/vsphere-credentials-controller-1.32.4.tgz
        version: 1.32.4
        namespace: kaas
        values:
          image:
            tag: 1.32.4
      - *kaas-ipam
      - name: squid-proxy
        helmV3: true
        chartURL: core/helm/squid-proxy-1.32.4.tgz
        version: 1.32.4
        namespace: kaas
        values:
          image:
            tag: 0.0.1-6
  - provider: equinixmetal
    helmReleases:
      - name: equinix-provider
        helmV3: true
        chartURL: core/helm/equinix-provider-1.32.4.tgz
        version: 1.32.4
        namespace: kaas
        values:
          equinixController:
            image:
              tag: 1.32.4
      - name: equinix-credentials-controller
        helmV3: true
        chartURL: core/helm/equinix-credentials-controller-1.32.4.tgz
        version: 1.32.4
        namespace: kaas
        values:
          image:
            tag: 1.32.4
      - *ceph-kkc-controller
  - provider: equinixmetalv2
    helmReleases:
      - name: equinix-provider
        helmV3: true
        chartURL: core/helm/equinixmetalv2-provider-1.32.4.tgz
        version: 1.32.4
        namespace: kaas
        values:
          equinixController:
            image:
              tag: 1.32.4
      - name: equinix-credentials-controller
        helmV3: true
        chartURL: core/helm/equinix-credentials-controller-1.32.4.tgz
        version: 1.32.4
        namespace: kaas
        values:
          config:
            providerVersion: v2
          image:
            tag: 1.32.4
      - *baremetal-api
      - *baremetal-operator
      - *kaas-ipam
      - *ceph-kkc-controller
  - provider: azure
    helmReleases:
      - name: azure-provider
        helmV3: true
        chartURL: core/helm/azure-provider-1.32.4.tgz
        version: 1.32.4
        namespace: kaas
        values:
          azureController:
            image:
              tag: 1.32.4
      - name: azure-credentials-controller
        helmV3: true
        chartURL: core/helm/azure-credentials-controller-1.32.4.tgz
        version: 1.32.4
        namespace: kaas
        values:
          image:
            tag: 1.32.4
  regionalHelmReleases:
    - name: lcm-controller
      helmV3: true
      chartURL: core/helm/lcm-controller-1.32.4.tgz
      version: 1.32.4
      namespace: kaas
      values:
        lcmControllerImage:
          tag: v0.3.0-257-ga93244da
    - name: mcc-cache
      helmV3: true
      chartURL: core/helm/mcc-cache-1.32.4.tgz
      version: 1.32.4
      namespace: kaas
      requires:
      - local-volume-provisioner
      localVolumes:
      - name: kaas-nginx-data
        bindMounts:
        - volPerNode: 1
      values:
        nginx:
          image:
            tag: 1.20.2-alpine
          volume:
            enabled: true
            storageClass: mcc-cache-kaas-nginx-data
        registry:
          image:
            tag: 2.7.1
        kproxy:
          image:
            tag: 1.32.4
    - name: agent-controller
      helmV3: true
      chartURL: core/helm/agent-controller-1.32.4.tgz
      version: 1.32.4
      namespace: kaas
      values:
        image:
          tag: 1.32.4
    - *rbac-controller
